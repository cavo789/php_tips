<!-- This file has been generated by the concat-md.ps1 script. -->
<!-- Don't modify this file manually (you'll loose your changes) -->
<!-- but run the tool once more -->

<!-- Last refresh date: 2020-09-21 10:54:56 -->

<!-- below, content of ./index.md -->

<!-- markdownlint-disable MD033 MD041 -->

# PHP Tricks

![Banner](./banner.svg)

> Tutorial and collection of tips and tricks for Visual Studio Code

<!-- table-of-contents - start -->
* [License](#license)
* [Coding tips](#coding-tips)
  * [Assert](#assert)
  * [Avoid option arrays in constructors](#avoid-option-arrays-in-constructors)
  * [Convert ANSI to UTF-8](#convert-ansi-to-utf-8)
  * [Never use public properties](#never-use-public-properties)
  * [Throw exceptions not false](#throw-exceptions-not-false)
* [Lectures](#lectures)
* [Tools](#tools)
  * [Code Quality](#code-quality)
  * [Others](#others)
<!-- table-of-contents - end -->

## License

[MIT](LICENSE)

<!-- below, content of ./coding_tips/readme.md -->

## Coding tips

<!-- below, content of ./coding_tips/assert/readme.md -->

### Assert

[https://github.com/webmozart/assert](https://github.com/webmozart/assert)

Stop to create your own exceptions and code like:

```php
public function __construct($id)
{
    if ($id !== (int) $id) {
        throw new \InvalidArgumentException(
            sprintf('The ID must be an integer. Got: %s',$id)
        );
    }

    if ((int) $id < 1) {
        throw new \InvalidArgumentException(
            sprintf('The ID must be a positive integer. Got: %s',$id)
        );
    }
}
```

Use `webmozart/assert` to make sure assertion in a cleaner and faster way:

```php
public function __construct($id)
{
    Assert::integer($id, 'The employee ID must be an integer. Got: %s');
    Assert::greaterThan($id, 0, 'The employee ID must be a positive integer. Got: %s');
}
```

[Read more](http://bestpractices.thecodingmachine.com/php/defensive_programming.html#use-an-assertion-library)

**Important: all assertions in the `Assert` class throw an `\InvalidArgumentException` if they fail.**

* [List of existing assertions](https://github.com/webmozart/assert#type-assertions)

<!-- below, content of ./coding_tips/avoid_arrays/readme.md -->

### Avoid option arrays in constructors

Using an array in a constructor makes impossible to know what the constructor really needs. Which keys in the array should be provided? The programmer who'll use the constructor can't know this without reading the documentation or the source code.

Instead of using an array, prefer to use an object like a `Configuration` class.

[Read more](http://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html#avoid-option-arrays-in-constructors)

<!-- below, content of ./coding_tips/encoding_ansi/readme.md -->

### Convert ANSI to UTF-8

One of the worst situations to deal with with PHP is the management of accents. When allowing a user to upload a file to the site; it must be guaranteed that the format is UTF-8 and not ANSI otherwise accented characters will be broken.

PHP has functions for this but, in many cases, these funtions aren't available since they relies on an extension.

By using a polyfill, we'll be safe i.e. if the function isn't defined by PHP, the polyfill will implement it.

We'll use a Symfony package for this: [https://packagist.org/packages/symfony/polyfill-mbstring](https://packagist.org/packages/symfony/polyfill-mbstring)

The idea is to detect the encoding type of an existing file and, if it isn't possible to get the type, suppose the file is an ANSI one. Then, convert the file and override the existing file so, after the `file_put_contents` action, we're sure the file is UTF-8 and accents are correctly managed.

Sample code below:

```php

// Import Mbstring so we can detect the file's encoding (UTF-8, ANSI, ...)
// Change filepaths to match yours
include './vendor/symfony/polyfill-mbstring/bootstrap.php';
include './vendor/symfony/polyfill-mbstring/Mbstring.php';

// Detect the encoding of the uploaded file.
$line     = fgets(fopen($file, 'r')); // Get the first line from the uploaded file
$encoding = mb_detect_encoding($line, null, false);

$fromType = 'UTF-8';

if (!$encoding) {
    // Impossible to detect the encoding type...
    // Suppose it was Windows-1252 encoded file
    $fromType = 'Windows-1252';
} else {
    $fromType = $encoding;
}

// Convert to UTF-8 and rewrite the file so accentuated chars are correctly handled now.
$content = mb_convert_encoding(file_get_contents($file), 'UTF-8', $fromType);
file_put_contents($file, $content);
```

<!-- below, content of ./coding_tips/no_public_properties/readme.md -->

### Never use public properties

A public property is accessible outside the class and can, f.i., be unset. A programmer can modify the property and thus break the class.

[Read more](http://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html#never-use-public-properties)

<!-- below, content of ./coding_tips/throw_exceptions/readme.md -->

### Throw exceptions not false

When writing a function, you should throw exceptions for error management instead of returning a boolean.

```php
function writeDateInFile(): void {
    $result = file_put_contents("date", date("Y-m-d"));
    if (false === $result) {
        throw new \FileWriteException("There was a problem writing file 'date'");
    }
}
```

[Read more](http://bestpractices.thecodingmachine.com/php/error_handling.html#using-exceptions)

* [PHP Safe, PHP functions, rewritten to throw exceptions instead of returning false](https://github.com/thecodingmachine/safe)
* [phpstan-safe-rule](https://github.com/thecodingmachine/phpstan-safe-rule)

<!-- below, content of ./lectures/readme.md -->

## Lectures

* [TheCodingMachine - Best practices](http://bestpractices.thecodingmachine.com/)
* [PHP Framework Interop Group](https://www.php-fig.org/)
* [PHP The Right Way](https://phptherightway.com/)

<!-- below, content of ./tools/readme.md -->

## Tools

### Code Quality

* `phan`: Static analyzer for PHP and warn about possible errors ([https://github.com/phan/phan](https://github.com/phan/phan))
* `php-cs-fixer`: PHP-CS-FIXER is a tool to automatically fix PHP Coding Standards issues ([https://github.com/FriendsOfPHP/PHP-CS-Fixer](https://github.com/FriendsOfPHP/PHP-CS-Fixer))
* `phpcbf`: Help to have good code formatting like solving indentation problems, putting open brackets on a new line, ([https://github.com/squizlabs/PHP_CodeSniffer](https://github.com/squizlabs/PHP_CodeSniffer))
* `phpcpd: Copy/Paste Detector (CPD) for PHP code. ([https://github.com/sebastianbergmann/phpcpd](https://github.com/sebastianbergmann/phpcpd))
* `phpcs`: Notify about code standard quality issues ([https://github.com/squizlabs/PHP_CodeSniffer](https://github.com/squizlabs/PHP_CodeSniffer))
* `phpmd`: Look for several potential problems within that source ([https://phpmd.org/](https://phpmd.org/))
* `phpmnd`: Detect the use of an hard-coded number and suggest constants ([https://github.com/povils/phpmnd](https://github.com/povils/phpmnd))
* `phpstan`: PHP Static Analysis Tool - discover bugs in your code without running it! ([https://github.com/phpstan/phpstan](https://github.com/phpstan/phpstan))
* `psalm`: Find errors in PHP applications ([https://github.com/vimeo/psalm](https://github.com/vimeo/psalm))
* `rector`: Refactoring tool ([https://github.com/rectorphp/rector](https://github.com/rectorphp/rector))

### Others

* [Visual Studio Code](https://code.visualstudio.com/)
* [Composer](https://github.com/composer/composer)
* [PhpUnit](https://github.com/sebastianbergmann/phpunit)
* [Monolog](https://github.com/Seldaek/monolog)
* [Xdebug](https://xdebug.org/)
